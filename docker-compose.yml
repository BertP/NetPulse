services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: netpulse-backend
    restart: unless-stopped
    network_mode: host
    # Host mode is preferred for Network Scanning (Arp/Ping) to work correctly on local subnet
    environment:
      - PORT=3001
      - SERVER_IP=${SERVER_IP}
      - UNIFI_URL=${UNIFI_URL}
      - UNIFI_USER=${UNIFI_USER}
      - UNIFI_PASSWORD=${UNIFI_PASSWORD}
      - UNIFI_SITE=${UNIFI_SITE}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASS=${SMTP_PASS}
      - SMTP_FROM=${SMTP_FROM}
      - SMTP_TO=${SMTP_TO}
      - ALERT_THRESHOLD_MIN=${ALERT_THRESHOLD_MIN}
      - DB_PATH=/app/data/netpulse.db
    volumes:
      - ./netpulse-data:/app/data
      - ./reports:/app/reports

  frontend:
    build:
      context: ./frontend
      dockerfile: ../Dockerfile.frontend
      args:
        - VITE_API_URL=http://${SERVER_IP}:3001
    container_name: netpulse-frontend
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - backend

# Note on Networking:
# Since backend uses 'network_mode: host', it is accessible at localhost:3000 from the host.
# Frontend in bridge mode needs to talk to backend.
# If backend is host mode, frontend can reach it via host network IP or if user accesses browser via host IP.
